---
description:
globs:
alwaysApply: false
---
## –¢–µ—Ö–Ω–∏—á–µ—Å–∫–æ–µ –∑–∞–¥–∞–Ω–∏–µ

**–ü—Ä–æ–µ–∫—Ç-–º–æ–¥—É–ª—å:** `imgdiff_ai`  
**–¶–µ–ª—å —Ä–µ–ª–∏–∑–∞:** –°–¥–µ–ª–∞—Ç—å ¬´—É–º–Ω—ã–π¬ª –¥–≤—É—Ö—Ü–≤–µ—Ç–Ω—ã–π –æverlay-diff, –∫–æ—Ç–æ—Ä—ã–π:

1. **–ú–∞–∫—Å–∏–º–∞–ª—å–Ω–æ –ø–æ–¥—á—ë—Ä–∫–∏–≤–∞–µ—Ç** –Ω–∞—Å—Ç–æ—è—â–∏–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è (–ø–æ—è–≤–∏–ª–æ—Å—å / –∏—Å—á–µ–∑–ª–æ).
    
2. **–£–±–∏—Ä–∞–µ—Ç –º—É—Å–æ—Ä** (—Å–∫–∞–Ω-—à—É–º, –∞–Ω—Ç–∏-–∞–ª–∏–∞—Å, —Å–¥–≤–∏–≥ –æ—Ç—Ç–µ–Ω–∫–æ–≤).
    
3. –î–∞—ë—Ç **–ø—Ä–æ–∑—Ä–∞—á–Ω—ã–π** PNG-–≤—ã—Ö–æ–¥ –¥–ª—è –ø–æ—Å–ª–µ–¥—É—é—â–µ–π –≤–µ—Ä—Å—Ç–∫–∏ –∏–ª–∏ –∞–Ω–∞–ª–∏–∑–∞ –Ω–µ–π—Ä–æ—Å–µ—Ç—å—é.
    
4. –ü–æ–∑–≤–æ–ª—è–µ—Ç –≥–∏–±–∫–æ –∏–≥—Ä–∞—Ç—å –ø–∞—Ä–∞–º–µ—Ç—Ä–∞–º–∏ –∏–∑ GUI/CLI.
    

---

### 1. –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞

| –°–ª–æ–π                           | –°—É—Ç—å                                                                                                                           |
| ------------------------------ |:------------------------------------------------------------------------------------------------------------------------------ |
| **core** (`diff_two_color.py`) | –ß–∏—Å—Ç–∞—è —Ñ—É–Ω–∫—Ü–∏—è `diff_two_color()` ‚Äî –ø—Ä–∏–Ω–∏–º–∞–µ—Ç 2 `ndarray`, –≤—ã–¥–∞—ë—Ç –≥–æ—Ç–æ–≤—ã–π `ndarray BGR[A]` –∏ –º–µ—Ç–∞–¥–∞–Ω–Ω—ã–µ.                       |
| **cli** (`__main__`)           | –ü–∞—Ä—Å–∏–Ω–≥ –∞—Ä–≥—É–º–µ–Ω—Ç–æ–≤, —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ PNG, –≤—ã–≤–æ–¥ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏.                                                                          |
| **gui** (PyQt5)                | –ú–∏–Ω–∏-–æ–∫–Ω–æ –¥–ª—è –∏–Ω–∂–µ–Ω–µ—Ä–æ–≤; —Ç—è–Ω–µ—Ç core ‚Üí –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç –ø—Ä–µ–≤—å—é. _GUI —É–∂–µ –µ—Å—Ç—å ‚Äî –ø—Ä–æ—Å—Ç–æ –∑–∞–º–µ–Ω–∏—Ç—å –≤—ã–∑–æ–≤ core, –¥–æ–±–∞–≤–∏—Ç—å –Ω–æ–≤—ã–µ —Ä—É–∫–æ—è—Ç–∫–∏._ |
| **tests**                      | pytest-–Ω–∞–±–æ—Ä –∏–∑ —Ç—Ä—ë—Ö –æ–±—Ä–∞–∑—Ü–æ–≤ (–∏–¥–µ–Ω—Ç–∏—á–Ω—ã–µ, –º–µ–ª–∫–∏–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è, —à—É–º).                                                             |

---

### 2. –ê–ª–≥–æ—Ä–∏—Ç–º **core**

| –®–∞–≥ | –¢—É–¥—É-–¥–µ–π—Å—Ç–≤–∏–µ                       | –î–µ—Ç–∞–ª–∏ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏                                                                      |
| --- | ----------------------------------- |:-------------------------------------------------------------------------------------- |
| 0   | **–ü—Ä–æ–≤–µ—Ä–∫–∞ —Ä–∞–∑–º–µ—Ä–æ–≤**               | `assert old.shape == new.shape`                                                        |
| 1   | **LAB-–∫–æ–Ω–≤–µ—Ä—Ç**                     | `old_lab = cv2.cvtColor(old, cv2.COLOR_BGR2LAB)`                                       |
| 2   | **–ó–Ω–∞–∫–æ–≤—ã–µ —Ä–∞–∑–Ω–∏—Ü—ã**                | `diff_add = cv2.subtract(new_lab, old_lab)``diff_del = cv2.subtract(old_lab, new_lab)` |
| 3   | **–°–µ—Ä—ã–π + –±–ª—é—Ä**                    | `gray = cv2.cvtColor(diff, cv2.COLOR_BGR2GRAY)` ‚Üí `GaussianBlur((3,3),0)`              |
| 4   | **–ê–¥–∞–ø—Ç–∏–≤–Ω—ã–π –ø–æ—Ä–æ–≥**                | `thr = np.percentile(gray, 100 - sens)``cv2.threshold(gray, thr, 255, THRESH_BINARY)`  |
| 5   | **Morph open** (optional)           | —É–±—Ä–∞—Ç—å –æ–¥–∏–Ω–æ—á–Ω—ã–µ —Ç–æ—á–∫–∏: `cv2.morphologyEx(mask, MORPH_OPEN, 3x3)`                      |
| 6   | **Min-area filter**                 | `cv2.findContours` ‚Üí —É–¥–∞–ª–∏—Ç—å –∫–æ–Ω—Ç—É—Ä—ã `< min_area`                                      |
| 7   | **Dilate (—Ç–æ–ª—â–∏–Ω–∞)**                | `cv2.dilate(mask, kernel_elliptic)`                                                    |
| 8   | **–ì–µ–Ω–µ—Ä–∞—Ü–∏—è —Ü–≤–µ—Ç–Ω–æ–≥–æ —Å–ª–æ—è**         | `overlay[mask>0] = (B,G,R)`                                                            |
| 9   | **Alpha-weight –ø–æ —Å–∏–ª–µ** (optional) | `alpha = gray / 255.0 ** gamma`                                                        |
| 10  | **–°–º–µ—à–∏–≤–∞–Ω–∏–µ**                      | `result = cv2.addWeighted(overlay, alpha, new, 1-alpha, 0)`                            |
| 11  | **–ú–µ—Ç—Ä–∏–∫–∏**                         | % —Å–æ–≤–ø–∞–≤—à–∏—Ö –ø–∏–∫—Å–µ–ª–µ–π, –ø–ª–æ—â–∞–¥—å diff etc.                                                |
| 12  | **–û—Ç–ª–∞–¥–æ—á–Ω—ã–π –≤—ã–≤–æ–¥**                | –µ—Å–ª–∏ `debug=True` ‚Üí –ø–∏—Å–∞—Ç—å `mask_add.png`, `mask_del.png`, `alpha.png`.                |

---

### 3. CLI-–∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å

```
python diff_two_color.py old.png new.png out.png \
  --sens 1          # –≤–µ—Ä—Ö–Ω–∏–π –ø—Ä–æ—Ü–µ–Ω—Ç —è—Ä–∫–æ—Å—Ç–∏ (1‚Äì10) ‚Üí —á—É–≤—Å—Ç–≤–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å
  --blur 3          # —è–¥—Ä–æ Gauss (0 = –Ω–µ—Ç)
  --open            # MORPH_OPEN True/False
  --min-area 20     # –æ—Ç—Å–µ—á—å –ø—è—Ç–Ω–∞ < N –ø–∏–∫—Å–µ–ª–µ–π
  --kernel 3        # Dilate px
  --alpha 0.6       # –±–∞–∑–æ–≤–∞—è –ø—Ä–æ–∑—Ä–∞—á–Ω–æ—Å—Ç—å
  --gamma 1.0       # —ç–∫—Å–ø–æ–Ω–µ–Ω—Ç–∞ –¥–ª—è Alpha-weight
  --del-color  FF3300
  --add-color  0066FF
  --debug
```

---

### 4. GUI-–æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ (PyQt5)

- **–°–ª–∞–π–¥–µ—Ä ¬´–ß—É–≤—Å—Ç–≤–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å¬ª** (1-10 %).
    
- **–ß–µ–∫–±–æ–∫—Å ¬´–§–∏–ª—å—Ç—Ä —à—É–º–∞¬ª** ‚Üí –≤–∫–ª—é—á–∞–µ—Ç blur+open.
    
- **Spin ¬´Min-area¬ª**.
    
- **Spin ¬´–¢–æ–ª—â–∏–Ω–∞ Dilate¬ª**.
    
- **–í—ã–±–æ—Ä —Ü–≤–µ—Ç–∞** Qt-ColorPicker –¥–ª—è –æ–±–æ–∏—Ö —Å–ª–æ—ë–≤.
    
- **Debug-mode** —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç –≤ –ø–æ–¥–ø–∞–ø–∫—É `debug/`.
    
- –ü—Ä–µ–≤—å—é = `QPixmap.fromImage(cv2qt(result))`.
    

---

### 5. –ó–∞–¥–∞—á–∏ (TODO-–ª–∏—Å—Ç)

| #   | –ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç | –ó–∞–¥–∞—á–∞                                                      | –ê—Ä—Ç–µ—Ñ–∞–∫—Ç                   |
| --- | --------- |:----------------------------------------------------------- | -------------------------- |
| 1   | üî¥        | –í—ã–Ω–µ—Å—Ç–∏ –∫–æ–¥ OpenCV ‚Üí `core.diff_two_color()`                | `core.py`                  |
| 2   | üî¥        | –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å —à–∞–≥–∏ 0-12                                       | E2E-—Ñ—É–Ω–∫—Ü–∏—è + docstring    |
| 3   | üü†        | –û–±–Ω–æ–≤–∏—Ç—å CLI (`argparse`)                                   | `diff_two_color.py`        |
| 4   | üü†        | –ü–æ–¥–∫–ª—é—á–∏—Ç—å core –≤ GUI, –¥–æ–±–∞–≤–∏—Ç—å –Ω–æ–≤—ã–µ —ç–ª–µ–º–µ–Ω—Ç—ã —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è   | `imgdiff_gui.py`           |
| 5   | üü°        | –ù–∞–ø–∏—Å–∞—Ç—å pytest-—Ñ–∞–π–ª —Å —Ñ–∏–∫—Å—Ç—É—Ä–∞–º–∏ (`tests/`)                | `test_diff.py`             |
| 6   | üü°        | –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –≤ `diff.log` (warnings, %diff)                  | `logging.basicConfig`      |
| 7   | üü°        | makefile / requirements (`opencv-python`, `PyQt5`, `numpy`) | `requirements.txt`         |
| 8   | ‚ö™        | CI GitHub Actions ‚Üí pytest + pylint                         | `.github/workflows/ci.yml` |

---

### 6. –ö—Ä–∏—Ç–µ—Ä–∏–∏ –ø—Ä–∏—ë–º–∫–∏

1. **–ò–Ω—Ç–µ—Ä—Ñ–µ–π—Å** ‚Äî –∑–∞–ø—É—Å–∫–∞–µ—Ç—Å—è `python diff_two_color.py ‚Ä¶`, —Å–æ–∑–¥–∞—ë—Ç PNG.
    
2. **GUI** ‚Äî —Å—Ä–∞–≤–Ω–∏–≤–∞–µ—Ç –±–µ–∑ –ø–∞–¥–µ–Ω–∏–π ‚â• 50 —Å—Ç—Ä. –ø–∞—Ä—Ç–∏–∏, –≤—ã–≤–æ–¥–∏—Ç %diff.
    
3. **–§–æ–Ω** ‚Äî –ø—Ä–æ–∑—Ä–∞—á–µ–Ω (RGBA), –±–∞–∑–æ–≤–∞—è –∫–∞—Ä—Ç–∏–Ω–∫–∞ —á–∏—Ç–∞–±–µ–ª—å–Ω–∞.
    
4. **–ò–∑–º–µ–Ω–µ–Ω–∏—è** ‚Äî –∫—Ä–∞—Å–Ω—ã–π/—Å–∏–Ω–∏–π –∫–æ–Ω—Ç—É—Ä —Ç–æ–ª—â–µ ‚â• `kernel`.
    
5. **–®—É–º** ‚Äî –º–µ–ª–∫–∏–µ —Ç–æ—á–∫–∏ (< `min_area`) –æ—Ç—Å—É—Ç—Å—Ç–≤—É—é—Ç.
    
6. **–Æ–Ω–∏—Ç-—Ç–µ—Å—Ç—ã** ‚Äî `pytest -q` –∑–µ–ª—ë–Ω—ã–π.
    

---

### 7. –†–µ—Å—É—Ä—Å—ã

- **–°—Ç–∞—Ä—Ç–æ–≤—ã–π –∫–æ–¥**: —Ç–≤–æ–π —Ñ–∞–π–ª `diff_two_color.py` (Canvas).
    
- **–¢–µ—Å—Ç–æ–≤—ã–µ –ø–∞—Ä—ã**: `samples/identical/*.png`, `samples/edited/*.png`.
    
- **–î–æ–∫**: —ç—Ç–æ –¢–ó + inline docstring.
    

### –ö–æ—Ä–æ—Ç–∫–æ ‚Äî –≥–ª–∞–≤–Ω—ã–µ ¬´—Ñ–∏—à–∫–∏¬ª, –∫–æ—Ç–æ—Ä—ã–µ –∏–Ω–¥—É—Å—Ç—Ä–∏—è –¥–∞–≤–Ω–æ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç

| –ü—Ä–∏—ë–º                                                                    | –ó–∞—á–µ–º                                                                       | –ì–¥–µ –≤—Å—Ç—Ä–µ—á–∞–µ—Ç—Å—è                                                                                                                                                                                                                                                                              |
| ------------------------------------------------------------------------ |:--------------------------------------------------------------------------- | -------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| **–î–≤–∞ –∑–Ω–∞–∫–æ–≤—ã—Ö —Å–ª–æ—è** (¬´—É—à–ª–æ¬ª / ¬´–ø–æ—è–≤–∏–ª–æ—Å—å¬ª) —Ä–∞–∑–Ω—ã–º–∏ —Ü–≤–µ—Ç–∞–º–∏             | –ú–≥–Ω–æ–≤–µ–Ω–Ω–æ –ø–æ–Ω—è—Ç–Ω–æ _—á—Ç–æ_ –∏—Å—á–µ–∑–ª–æ –∏ _—á—Ç–æ_ –¥–æ–±–∞–≤–∏–ª–æ—Å—å                          | diff-—Å–∫—Ä–∏–ø—Ç—ã –≤ game-dev, **ImageMagick** –ø—Ä–∏–º–µ—Ä—ã ([legacy.imagemagick.org](https://legacy.imagemagick.org/discourse-server/viewtopic.php?t=34140&utm_source=chatgpt.com "Setting different colors to differences between two images"))                                                       |
| **LAB-–∏–ª–∏ L*Œ±Œ≤ –ø—Ä–æ—Å—Ç—Ä–∞–Ω—Å—Ç–≤–æ, –Ω–µ RGB**                                    | –Ø—Ä–∫–æ—Å—Ç—å –∏ —Ü–≤–µ—Ç –æ—Ü–µ–Ω–∏–≤–∞—é—Ç—Å—è –ø–æ-–æ—Ç–¥–µ–ª—å–Ω–æ—Å—Ç–∏ ‚Üí –º–µ–Ω—å—à–µ –ª–æ–∂–Ω—ã—Ö ¬´—Ü–≤–µ—Ç–æ–≤—ã—Ö¬ª –¥–∏—Ñ—Ñ–æ–≤ | OpenCV / CVAT / —Ä–æ–±–æ-QA –ø–∞–π–ø–ª–∞–π–Ω—ã                                                                                                                                                                                                                                                            |
| **–ö–æ–Ω—Ç—Ä–∞—Å—Ç-stretch + –∞–¥–∞–ø—Ç–∏–≤–Ω—ã–π –ø–æ—Ä–æ–≥** (`evaluate log` –∏–ª–∏ percentiles) | –û–¥–∏–Ω –ø–æ—Ä–æ–≥ —Ä–∞–±–æ—Ç–∞–µ—Ç –Ω–∞ —Å–≤–µ—Ç–ª—ã—Ö –∏ —Ç—ë–º–Ω—ã—Ö —Å—Ç—Ä–∞–Ω–∏—Ü–∞—Ö                           | White-paper Atlassian Visual-Diff                                                                                                                                                                                                                                                            |
| **–§–∏–ª—å—Ç—Ä ¬´–º–µ–Ω—å—à–µ N px¬ª + Morph Open**                                    | –û—Ç—Ä—É–±–∞–µ—Ç –ø—ã–ª—å —Å–∫–∞–Ω–µ—Ä–∞, JPEG-–∞—Ä—Ç–µ—Ñ–∞–∫—Ç—ã                                       | PerceptualDiff, Resemble.js                                                                                                                                                                                                                                                                  |
| **–î–∏–Ω–∞–º–∏—á–µ—Å–∫–∞—è Œ±-–ø—Ä–æ–∑—Ä–∞—á–Ω–æ—Å—Ç—å –ø–æ —Å–∏–ª–µ –æ—Ç–ª–∏—á–∏—è**                          | –¢–æ–Ω–∫–∏–µ —à—Ç—Ä–∏—Ö–∏ ‚Üí –ø–æ–ª—É–ø—Ä–æ–∑—Ä–∞—á–Ω—ã–µ; –∂–∏—Ä–Ω—ã–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è ‚Üí –Ω–∞—Å—ã—â–µ–Ω–Ω—ã–µ               | PyImageSearch overlay tut ([pyimagesearch.com](https://pyimagesearch.com/2016/03/07/transparent-overlays-with-opencv/?utm_source=chatgpt.com "Transparent overlays with OpenCV - PyImageSearch"))                                                                                            |
| **Heat-map fallback** (–æ–¥–Ω–æ—Ü–≤–µ—Ç–Ω–∞—è –≥—Ä–∞–¥–∞—Ü–∏—è)                             | –ö–æ–≥–¥–∞ –∑–Ω–∞–∫ –Ω–µ –≤–∞–∂–µ–Ω, –Ω–æ –∏–Ω—Ç–µ—Ä–µ—Å–Ω–∞ ¬´—Å–∏–ª–∞¬ª –∏ —Ä–∞—Å–ø–æ–ª–æ–∂–µ–Ω–∏–µ                     | Magick `difference+clut`, web diff-viewers                                                                                                                                                                                                                                                   |
| **SSIM-–∫–∞—Ä—Ç–∞ –≤–º–µ—Å—Ç–æ                                                      | A-B                                                                         | **                                                                                                                                                                                                                                                                                           |
| **Blue + Orange/Red –ø–∞–ª–∏—Ç—Ä–∞**                                            | –ù–∞ –ª—é–±–æ–π –ø–æ–¥–ª–æ–∂–∫–µ, –¥—Ä—É–∂–µ–ª—é–±–Ω–∞ –∫ –ª—é–¥—è–º —Å CVD                                 | –≤–∏–∑—É–∞–ª-–≥–∞–π–¥—ã (Stats.SE) ([stats.stackexchange.com](https://stats.stackexchange.com/questions/118033/best-series-of-colors-to-use-for-differentiating-series-in-publication-quality?utm_source=chatgpt.com "\"Best\" series of colors to use for differentiating series in publication ...")) |

---

## –ß—Ç–æ –∏–º–µ–µ—Ç —Å–º—ã—Å–ª –ø–æ–¥—á–µ—Ä–∫–Ω—É—Ç—å –∏ –¥–æ–±–∞–≤–∏—Ç—å –≤ —Ç–≤–æ–π —Å–∫—Ä–∏–ø—Ç

| –ë–ª–æ–∫                     | –ß—Ç–æ –¥–æ–±–∞–≤–∏—Ç—å / –ø—Ä–æ–≤–µ—Ä–∏—Ç—å                                                    | –ü–æ—á–µ–º—É –≤–∞–∂–Ω–æ                                     |
| ------------------------ |:--------------------------------------------------------------------------- | ------------------------------------------------ |
| **–ü—Ä–µ–¥–æ–±—Ä–∞–±–æ—Ç–∫–∞ —à—É–º–∞**   | `GaussianBlur(3√ó3)` _–¥–æ_ –ø–æ—Ä–æ–≥–∞ + `cv2.morphologyEx(open)` + `min_area`     | –ø–æ–¥–∞–≤–ª—è–µ—Ç 1-–ø–∏–∫—Å–µ–ª—å–Ω—ã–µ –∞—Ä—Ç–µ—Ñ–∞–∫—Ç—ã —Å–∫–∞–Ω–∞           |
| **LAB-diff**             | `cv2.cvtColor(..., BGR2LAB)` ‚Üí `subtract`                                   | —è—Ä–∫–æ—Å—Ç—å –∏ —Ü–≤–µ—Ç –¥–∏—Ñ—Ñ–µ—Ä–µ–Ω—Ü–∏—Ä—É—é—Ç—Å—è –ª—É—á—à–µ, —á–µ–º –≤ RGB |
| **–ê–¥–∞–ø—Ç–∏–≤–Ω—ã–π –ø–æ—Ä–æ–≥**     | `thr = np.percentile(gray, 100-sens)` _sens = 1-10 %_                       | –æ–¥–∏–Ω —Å–∫—Ä–∏–ø—Ç —Ä–∞–±–æ—Ç–∞–µ—Ç –Ω–∞ –±–µ–ª—ã—Ö –∏ —Å–µ—Ä—ã—Ö –ª–∏—Å—Ç–∞—Ö     |
| **Alpha-weight –ø–æ —Å–∏–ª–µ** | `alpha = gray/255 **Œ≥`; Œ≥‚âà0.7                                               | —Å–ª–∞–±—ã–µ —à—Ç—Ä–∏—Ö–∏ ‚âà 30 % –ø—Ä–æ–∑—Ä–∞—á–Ω–æ—Å—Ç–∏, –∂–∏—Ä–Ω—ã–µ ‚Äî 80 % |
| **SSIM-—Ñ–ª–∞–≥** (–æ–ø—Ü–∏—è)    | –¥–ª—è —Ç–æ–Ω–∫–∏—Ö —Å–¥–≤–∏–≥–æ–≤ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å SSIM-map –≤–º–µ—Å—Ç–æ `subtract`                  | —É–±–∏—Ä–∞–µ—Ç –ª–æ–∂–Ω—ã–µ –¥–∏—Ñ—Ñ—ã –Ω–∞ –ø–æ–ª—É—Ç–æ–Ω–∞—Ö —Ç–µ–∫—Å—Ç–∞         |
| **–¶–≤–µ—Ç–æ–≤–æ–π –≤—ã–±–æ—Ä**       | –¥–µ—Ñ–æ–ª—Ç—ã: `#FF3300` (gone) / `#0066FF` (add); –¥–∞—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é color-picker | –ø–∞–ª–∏—Ç—Ä–∞ —á–∏—Ç–∞–µ—Ç—Å—è –¥–∞–∂–µ –ø—Ä–∏ –¥–∞–ª—å—Ç–æ–Ω–∏–∑–º–µ            |
| **Debug-mode**           | —Å–æ—Ö—Ä–∞–Ω—è—Ç—å `mask_add.png`, `mask_del.png`, `alpha.png`                       | –±—ã—Å—Ç—Ä–æ –≤–∏–¥–Ω–æ, ¬´–∑–∞–∂–∞–ª–∏¬ª –ª–∏ –ø–æ—Ä–æ–≥                  |
| **CLI / GUI —Ä—É–∫–æ—è—Ç–∫–∏**   | sens %, kernel px, min_area, gamma, —Ü–≤–µ—Ç–∞, ¬´–∏—Å–ø. SSIM¬ª                      | —É–¥–æ–±—Å—Ç–≤–æ –∏–Ω–∂–µ–Ω–µ—Ä–∞ ‚Üí                              |

---

## –†–∞—Å–∫–ª–∞–¥ –Ω–∞ –∑–∞–¥–∞—á–∏ (–¥–æ–ø–æ–ª–Ω—è–µ—Ç —Ç–≤–æ–π TODO)

1. **LAB diff + adaptive threshold** –≤ core-—Ñ—É–Ω–∫—Ü–∏–∏.
    
2. **Blur + Open + min_area** –∑–∞ –æ–¥–Ω–∏–º —Ñ–ª–∞–≥–æ–º `--denoise`.
    
3. **Alpha-weight** —Å –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–º `--gamma`.
    
4. **–û–ø—Ü–∏–æ–Ω–∞–ª—å–Ω—ã–π SSIM** (skimage).
    
5. **Debug-—Å–µ–π–≤** –ø—Ä–∏ `--debug`.
    

> –≠—Ç–æ —É–∂–µ –æ—Ç—Ç–æ—á–µ–Ω–æ –≤ open-source (Resemble.js, diffimg) –∏ —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è—Ö ImageMagick community ([legacy.imagemagick.org](https://legacy.imagemagick.org/discourse-server/viewtopic.php?t=34140&utm_source=chatgpt.com "Setting different colors to differences between two images")), PyImageSearch overlay ([pyimagesearch.com](https://pyimagesearch.com/2016/03/07/transparent-overlays-with-opencv/?utm_source=chatgpt.com "Transparent overlays with OpenCV - PyImageSearch")) ‚Äî —Å—Ç–æ–∏—Ç –ø—Ä–æ—Å—Ç–æ –ø–µ—Ä–µ–Ω–µ—Å—Ç–∏.


---

## –ö–∞–∫ —Å–¥–µ–ª–∞—Ç—å ¬´–ø–µ—Ä–µ–¥–≤–∏–≥–∞–µ–º—ã–π —Ä–∞–∑–¥–µ–ª–∏—Ç–µ–ª—å¬ª (before/after-—Å–ª–∞–π–¥–µ—Ä) –∏ –Ω–µ –ø–æ–ª—É—á–∏—Ç—å —Ç–æ—Ä–º–æ–∑–∞

### 1. –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ –≤–∏–¥–∂–µ—Ç–∞

| –°–ª–æ–π –≤ —Å—Ç–µ–∫–µ                                             | –ß—Ç–æ –¥–µ–ª–∞–µ—Ç                                                 |
| -------------------------------------------------------- |:---------------------------------------------------------- |
| **Bottom ‚Äì –Ω–æ–≤–æ–µ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ** (_–∏–ª–∏ –æ–±—ä–µ–¥–∏–Ω—ë–Ω–Ω—ã–π diff_) | –æ–±—ã—á–Ω—ã–π `QLabel`/`QPixmap`                                 |
| **Top ‚Äì —Å—Ç–∞—Ä–æ–µ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ**                             | –ø–æ–≤–µ—Ä—Ö, —Ç–æ—Ç –∂–µ —Ä–∞–∑–º–µ—Ä                                      |
| **Mask-clip**                                            | –ü—Ä—è–º–æ—É–≥–æ–ª—å–Ω–∞—è –º–∞—Å–∫–∞ —à–∏—Ä–∏–Ω–æ–π _sliderPos_; –≤—Å—ë —Å–ø—Ä–∞–≤–∞ —Å–∫—Ä—ã—Ç–æ |
| **Handle**                                               | –£–∑–∫–∏–π `QFrame` / `QGraphicsLineItem`, —Ü–µ–ø–ª—è–µ—Ç —Å–æ–±—ã—Ç–∏—è –º—ã—à–∏ |

–ë–∞–∑–æ–≤–∞—è –∏–¥–µ—è: –¥–≤–∏–≥–∞–µ–º –º–∞—Å–∫—É ‚Üí –≤–µ—Ä—Ö–Ω—è—è –∫–∞—Ä—Ç–∏–Ω–∫–∞ ¬´–æ—Ç–∫—Ä—ã–≤–∞–µ—Ç¬ª –Ω–∏–∂–Ω—é—é.

### 2. –ë–∞–∑–æ–≤–∞—è —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è (PyQt 5/6, –±–µ–∑ OpenGL)

```python
class SliderReveal(QWidget):
    def __init__(self, pix_old: QPixmap, pix_new: QPixmap, parent=None):
        super().__init__(parent)
        self.old_label = QLabel(self);  self.old_label.setPixmap(pix_old)
        self.new_label = QLabel(self);  self.new_label.setPixmap(pix_new)
        self.split_x = self.width() // 2

    def resizeEvent(self, _):
        self.old_label.resize(self.size())
        self.new_label.resize(self.size())
        self.update_mask()

    def mousePressEvent(self, e):  self.update_split(e.x())
    def mouseMoveEvent(self, e):   self.update_split(e.x())

    def update_split(self, x):
        self.split_x = max(0, min(x, self.width()))
        self.update_mask()

    def update_mask(self):
        region = QRegion(0, 0, self.split_x, self.height())
        self.old_label.setMask(region)
        self.update()
```

_–û—Ç—Ä–∏—Å–æ–≤—ã–≤–∞—é—Ç—Å—è –≤—Å–µ–≥–æ –¥–≤–∞ `QPixmap`, –º–∞—Å–∫–∞ –º–µ–Ω—è–µ—Ç—Å—è –∑–∞ ‚âà0.1 –º—Å._

### 3. –ì–¥–µ –º–æ–∂–µ—Ç ¬´–ø–æ–¥–≤–∏—Å–Ω—É—Ç—å¬ª –∏ –∫–∞–∫ —É—Å–∫–æ—Ä–∏—Ç—å

| –£–∑–∫–æ–µ –º–µ—Å—Ç–æ                            | –õ–µ–∫–∞—Ä—Å—Ç–≤–æ                                                                                                                  |
| -------------------------------------- |:-------------------------------------------------------------------------------------------------------------------------- |
| **–û—á–µ–Ω—å –±–æ–ª—å—à–∏–µ TIFF/PNG** (> 8k √ó 8k) | ‚ë† –°–æ—Ö—Ä–∞–Ω—è—Ç—å –æ—Ç–¥–µ–ª—å–Ω—ã–π ¬´preview PNG¬ª (e.g. 2000 px) –¥–ª—è UI; ‚ë° –ü–æ–¥–≥—Ä—É–∂–∞—Ç—å –ø–æ–ª–Ω–æ—Ä–∞–∑–º–µ—Ä–Ω—ã–π diff —Ç–æ–ª—å–∫–æ –ø–æ –¥–≤–æ–π–Ω–æ–º—É –∫–ª–∏–∫—É       |
| –ú–∞—Å–∫–∞ ‚Üí –º–Ω–æ–≥–æ—Ä–∞–∑–æ–≤—ã–π `setMask`         | –ö–µ—à–∏—Ä–æ–≤–∞—Ç—å `QRegion` (Qt ‚â• 5.15 —É–º–µ–µ—Ç implicit-sharing ‚Äî —É–∂–µ –±—ã—Å—Ç—Ä–æ)                                                       |
| –û—Ç—Ä–∏—Å–æ–≤–∫–∞ –ø—Ä–∏ –∫–∞–∂–¥–æ–º `mouseMove`       | –û–≥—Ä–∞–Ω–∏—á–∏—Ç—å FPS (`QElapsedTimer`, –Ω–µ —á–∞—â–µ 60 –ì—Ü)                                                                            |
| DPI-scale/High-DPI                     | –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å `pixmap = source.scaled(self.size(), Qt.KeepAspectRatio, Qt.SmoothTransformation)` –æ–¥–∏–Ω —Ä–∞–∑ –ø—Ä–∏ `resizeEvent` |

### 4. –ù—É–∂–Ω–æ **–µ—â—ë** –±—ã—Å—Ç—Ä–µ–µ ‚Üí OpenGL

_–ü–æ—Ä–æ–≥: –µ—Å–ª–∏ –¥–∏—Ñ—ã 12k √ó 12k –∏ –∏–Ω–∂–µ–Ω–µ—Ä –≥–æ–Ω—è–µ—Ç –ø–æ–ª–∑—É–Ω–æ–∫ 100 —Ä–∞–∑/—Å._

```python
class GLReveal(QOpenGLWidget):
    ...
    def paintGL(self):
        glBindTexture(GL_TEXTURE_2D, self.tex_old)
        # —Ä–∏—Å—É–µ–º quad —Å–ª–µ–≤–∞ –æ—Ç split
        glBindTexture(GL_TEXTURE_2D, self.tex_new)
        # —Ä–∏—Å—É–µ–º quad —Ü–µ–ª–∏–∫–æ–º
        # split_x –ø–µ—Ä–µ–¥–∞—ë–º –∫–∞–∫ uniform, –æ–±—Ä–µ–∑–∫–∞ –≤ —à–µ–π–¥–µ—Ä–µ
```

GPU-–∫–ª–∏–ø —Ä–∞–±–æ—Ç–∞–µ—Ç –±–µ–∑ —Å–æ–∑–¥–∞–Ω–∏—è mask-–æ–±—ä–µ–∫—Ç–æ–≤ ‚Üí –º–≥–Ω–æ–≤–µ–Ω–Ω–æ.

–õ—ë–≥–∫–∏–π –ø—É—Ç—å ‚Äî –≤–∑—è—Ç—å **PyQtGraph** (`pg.ImageItem`) –∏ clip-rect–æ–º –¥–≤–∏–≥–∞—Ç—å ROI.

### 5. ¬´–ú—É—Å–æ—Ä –ø–æ–ª—É–ø—Ä–æ–∑—Ä–∞—á–Ω—ã–π, —Ä–∞–∑–Ω–∏—Ü–∞ —è—Ä–∫–∞—è¬ª

1. **Diff-–ø—Ä–µ–ø—Ä–æ—Ü–µ—Å—Å–∏–Ω–≥** —É–∂–µ –≥–æ—Ç–æ–≤ (LAB + adaptive threshold).
    
2. –í —Å–ª–∞–π–¥–µ—Ä–µ –ø–æ–∫–∞–∑—ã–≤–∞–µ–º **`pix_new`** —Å–Ω–∏–∑—É, **`pix_new + transparent diff`** —Å–≤–µ—Ä—Ö—É:
    
    - —Å–æ–≤–ø–∞–≤—à–∏–µ –ø–∏–∫—Å–µ–ª–∏ ‚Üí Œ± = 0 ‚Üí –Ω–µ –≤–∏–¥–Ω—ã;
        
    - –æ—Ç–ª–∏—á–∏—è ‚Üí Œ± = 0.6 ‚Üí –≤–∏–¥–Ω–æ;
        
    - –ø—Ä–∏ –¥–≤–∏–∂–µ–Ω–∏–∏ —Ä–∞–∑–¥–µ–ª–∏—Ç–µ–ª—è —Å–º–µ–Ω–∞ —Å–ª–æ—è –º–∏–Ω–∏–º–∞–ª—å–Ω–∞.
        

### 6. TODO-–ª–∏—Å—Ç –¥–ª—è Cursor

| ‚Ññ   | –ó–∞–¥–∞—á–∞                                                  | –§–∞–π–ª/–∫–ª–∞—Å—Å                    |
| --- | ------------------------------------------------------- |:----------------------------- |
| 1   | –ò–º–ø–ª–µ–º–µ–Ω—Ç–∏—Ä–æ–≤–∞—Ç—å `SliderReveal` –Ω–∞ –æ—Å–Ω–æ–≤–µ mask          | `widgets/reveal.py`           |
| 2   | –î–æ–±–∞–≤–∏—Ç—å –≤ GUI —Ç—Ä–µ—Ç–∏–π —Ç–∞–± ¬´–°–ª–∞–π–¥–µ—Ä¬ª                     | `imgdiff_gui.py`              |
| 3   | –î–µ–ª–∞—Ç—å down-scaled –ø—Ä–µ–≤—å—é (`maxSide=2000`) –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ | „ÄÉ                            |
| 4   | –û–≥—Ä–∞–Ω–∏—á–∏—Ç—å –ø–µ—Ä–µ—Ä–∏—Å–æ–≤–∫—É –¥–æ 60 FPS                        | `SliderReveal.update_split()` |
| 5   | (–æ–ø—Ü.) –í–µ—Ä—Å–∏—è `GLReveal` —Å PyQt >= 6.4 + OpenGL ES      | `widgets/reveal_gl.py`        |

---

### –ò—Ç–æ–≥

- **Python + PyQt5** –æ—Å—Ç–∞—ë—Ç—Å—è; –Ω–∏–∫–∞–∫–∏–µ Electron/JS –Ω–µ –Ω—É–∂–Ω—ã.
    
- –î–ª—è –±–æ–ª—å—à–∏–Ω—Å—Ç–≤–∞ —á–µ—Ä—Ç–µ–∂–µ–π —Ö–≤–∞—Ç–∞–µ—Ç –º–∞—Å–∫–∏—Ä–æ–≤–∞–Ω–Ω–æ–≥–æ `QPixmap` ‚Äî 100+ FPS.
    
- –ï—Å–ª–∏ –ø–æ—è–≤—è—Ç—Å—è —Å—É–ø–µ—Ä-–±–æ–ª—å—à–∏–µ –ø–ª–∞–Ω—ã ‚Üí –ø–µ—Ä–µ–∫–ª—é—á–∞–µ–º—Å—è –Ω–∞ `QOpenGLWidget`.
    
- –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è –≤ —Ç–≤–æ–π —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–π GUI ‚Äî 100‚Äì120 —Å—Ç—Ä–æ–∫, —Ä–∞–±–æ—Ç–∞ ¬´–Ω–∞ –≥–ª–∞–∑¬ª instant-smooth.